package com.coreyd97.antivirus.common.report;

import com.coreyd97.antivirus.common.engine.DetectionModule;
import com.coreyd97.antivirus.common.taskscheduler.ScanTask;

import java.io.File;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.UUID;

public class ScanReport extends Report {
    private UUID taskUUID;
    private String detectionModule;
    private ArrayList<FileFeatures> fileFeatures;

    public ScanReport(DetectionModule detectionModule, ScanTask scanTask){
        this.detectionModule = detectionModule.getModuleName();
        this.taskUUID = scanTask.getUUID();
        fileFeatures = new ArrayList<>();
    }

    public FileFeatures addFile(File file){
        FileFeatures fileFeatures = new FileFeatures(file);
        this.fileFeatures.add(fileFeatures);
        return fileFeatures;
    }

    public UUID getTaskUUID() {
        return taskUUID;
    }

    public void setTaskUUID(UUID taskUUID) {
        this.taskUUID = taskUUID;
    }

    public String getDetectionModule() {
        return detectionModule;
    }

    public ArrayList<FileFeatures> getFileFeatures() {
        return fileFeatures;
    }

    public String toString(){
        StringBuilder sb = new StringBuilder();
        sb.append(detectionModule + "\n");
        for (FileFeatures fileFeature : fileFeatures) {
            sb.append(fileFeature.filePath + " - " + fileFeature.fileSize + "kb\n");
            if(fileFeature.featureMap != null)
                fileFeature.featureMap.forEach((key, value) -> sb.append(key + " - "  + value + "\n"));
            sb.append("--------------");
            if(fileFeature.featureList != null) {
                for (Object o : fileFeature.featureList) {
                    sb.append(o.toString() + "\n");
                }
            }
            sb.append("--------------");
            sb.append("--------------");
            sb.append("\n\n");
        }
        return sb.toString();
    }
}
