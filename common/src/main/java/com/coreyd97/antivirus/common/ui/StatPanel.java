package com.coreyd97.antivirus.common.ui;

import com.coreyd97.antivirus.common.stats.StatProvider;
import com.coreyd97.antivirus.common.stats.StatProviderManager;

import javax.swing.*;
import java.awt.*;
import java.util.HashMap;

public class StatPanel extends JScrollPane {
    private final StatProviderManager statProviderManager;
    private final JPanel contentPanel;
    private final HashMap<StatProvider, JPanel> statGroups;
    private final GridBagConstraints gbc;

    public StatPanel(StatProviderManager statProviderManager){
        this.statProviderManager = statProviderManager;
        this.contentPanel = new JPanel();
        this.setMaximumSize(this.getSize());
        this.setViewportView(this.contentPanel);
        this.statGroups = new HashMap<>();
        contentPanel.setLayout(new GridBagLayout());
        this.gbc = new GridBagConstraints();
        gbc.fill = GridBagConstraints.BOTH;
        gbc.weightx = 1;
        gbc.weighty = 0;
        gbc.gridx = gbc.gridy = 1;
        gbc.ipady = 7;

        GridBagConstraints padGbc = new GridBagConstraints();
        padGbc.fill = GridBagConstraints.BOTH;
        padGbc.weightx = 1;
        padGbc.weighty = 1;
        padGbc.gridx = 1;
        padGbc.gridy = 9999;
        contentPanel.add(new JPanel(), padGbc);

        updatePanel();

        Timer timer = new Timer(1000 * 20, actionEvent -> {
            //TODO do timer stuff
        });
    }

    public void addStatGroup(StatProvider provider){
        JPanel statPanel = provider.getStatPanel();
        this.statGroups.put(provider, statPanel);
        gbc.gridy++;
        this.contentPanel.add(statPanel, gbc);
    }

    public void removeStatGroup(StatProvider provider){
        JPanel stats = this.statGroups.remove(provider);
        if(stats == null) return;
        this.contentPanel.remove(stats);
        this.revalidate();
        this.repaint();
    }

    public void updatePanel(){
        for (StatProvider statProvider : statProviderManager.getStatProviders()) {
            if(!statGroups.containsKey(statProvider)){
                addStatGroup(statProvider);
            }
        }
    }

}
