package com.coreyd97.antivirus.common.report;

import com.coreyd97.antivirus.common.engine.DetectionModule;
import com.coreyd97.antivirus.common.taskscheduler.TrainTask;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.Map;
import java.util.UUID;

//Store statistics and information regarding the training of a heuristic engine.
public class TrainReport extends Report {
    public final UUID taskUUID;
    public final String detectionModule;
    public int trainedSamples, failedSamples;
    Map<String, ArrayList<String>> causeOfFailure;

    public TrainReport(DetectionModule detectionModule, TrainTask trainTask){
        this.detectionModule = detectionModule.getModuleName();
        this.taskUUID = trainTask.getUUID();
        this.causeOfFailure = new HashMap<>();
    }

    public void addFailedSample(String cause, String filePath){
        failedSamples++;
        if(causeOfFailure.containsKey(cause)){
            causeOfFailure.get(cause).add(filePath);
        }else{
            ArrayList<String> filenames = new ArrayList<>();
            filenames.add(filePath);
            causeOfFailure.put(cause, filenames);
        }
    }

    @Override
    public String toString() {
        StringBuilder sb = new StringBuilder();
        sb.append("Total Trained Samples: " + trainedSamples + "\n");
        sb.append("Failed Samples: " + failedSamples + "\n");
        sb.append("Causes of Failure: \n");
        for (String cause : causeOfFailure.keySet()) {
            sb.append(cause + "\n");
            for(String filename : causeOfFailure.get(cause)){
                sb.append(filename + ", ");
            }
            sb.append("\n");
        }
        return sb.toString();
    }
}
