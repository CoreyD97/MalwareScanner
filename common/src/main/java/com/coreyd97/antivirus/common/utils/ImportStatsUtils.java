package com.coreyd97.antivirus.common.utils;

import com.github.katjahahn.parser.sections.idata.ImportDLL;
import com.github.katjahahn.parser.sections.idata.NameImport;
import com.github.katjahahn.parser.sections.idata.OrdinalImport;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;

public class ImportStatsUtils {

    public static HashMap<String, ArrayList<String>> convertToImportMap(List<ImportDLL> importList) {

        HashMap<String, ArrayList<String>> dllFunctionMap = new HashMap<>();

        for (ImportDLL importDLL : importList) {
            ArrayList<String> dllFunctions = dllFunctionMap.get(importDLL.getName());
            if(dllFunctions == null){
                dllFunctions = new ArrayList<>();
                dllFunctionMap.put(importDLL.getName(), dllFunctions);
            }

            for (NameImport nameImport : importDLL.getNameImports()) {
                dllFunctions.add(nameImport.getName());
            }

            for (OrdinalImport ordinalImport : importDLL.getOrdinalImports()) {
                dllFunctions.add("ORD(" + ordinalImport.getOrdinal() + ")");
            }
        }

        return dllFunctionMap;
    }

    public static ArrayList<DllFunction> convertToImportList(List<ImportDLL> importList) {
        ArrayList<DllFunction> functions = new ArrayList<>();
        for (ImportDLL importDLL : importList) {
            for (NameImport nameImport : importDLL.getNameImports()) {
                functions.add(new DllFunction(importDLL.getName(), nameImport.getName()));
            }

            for (OrdinalImport ordinalImport : importDLL.getOrdinalImports()) {
                functions.add(new DllFunction(importDLL.getName(), "ORD(" + ordinalImport.getOrdinal() + ")"));
            }
        }

        return functions;
    }


    public static class DllFunction {
        public String dllName, functionName;

        public DllFunction(String dllName, String functionName){
            this.dllName = dllName;
            this.functionName = functionName;
        }
    }

}
