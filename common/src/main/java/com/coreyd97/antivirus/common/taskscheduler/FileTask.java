package com.coreyd97.antivirus.common.taskscheduler;

import com.coreyd97.antivirus.common.report.Report;

import java.io.File;
import java.io.IOException;
import java.security.NoSuchAlgorithmException;

public abstract class FileTask extends Task {
    private File[] files;
    protected Report report;

    protected FileTask(String taskName, File[] files, Report report) {
        super(taskName);
        this.files = files;
        this.report = report;
    }

    //Implement in subclasses to define handling of each file.
    protected abstract void processFile(File file);

    private void processFiles(File files[]){
        for (File file : files) {
            if(file.isDirectory()){
                File[] childFiles = file.listFiles();
                if(childFiles == null) return;
                taskAddSteps(childFiles.length);
                processFiles(childFiles);
            }else{
                processFile(file);
                taskProgress();
            }
        }
    }

    public Report call() throws Exception{
        taskStart(files.length);
        processFiles(this.files);
        taskComplete();
        return this.report;
    }
}
