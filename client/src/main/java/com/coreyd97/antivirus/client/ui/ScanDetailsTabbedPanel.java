package com.coreyd97.antivirus.client.ui;

import com.coreyd97.antivirus.client.engine.ScanManager;
import com.coreyd97.antivirus.common.taskscheduler.ScanTask;
import com.coreyd97.antivirus.common.taskscheduler.Task;
import com.coreyd97.antivirus.common.taskscheduler.TaskSchedulerListener;

import javax.swing.*;
import java.util.HashMap;

public class ScanDetailsTabbedPanel extends JTabbedPane implements TaskSchedulerListener {

    private final ScanManager scanManager;
    HashMap<ScanTask, ActiveScanPanel> taskScanPanels;

    public ScanDetailsTabbedPanel(ScanManager scanManager) {
        this.scanManager = scanManager;
        this.taskScanPanels = new HashMap<>();
    }

    @Override
    public void onTaskAdded(Task task) {
        if(task instanceof ScanTask && ((ScanTask) task).getType() == ScanTask.ScanType.SCAN){
            ActiveScanPanel activeScanPanel = new ActiveScanPanel(scanManager, (ScanTask) task);
            this.taskScanPanels.put((ScanTask) task, activeScanPanel);
            this.addTab(task.getTaskName(), activeScanPanel);
            this.revalidate();
            this.repaint();
        }
    }

    @Override
    public void onTaskRemoved(Task task) {
        //Clean up ui elements
        ActiveScanPanel activeScanPanel = this.taskScanPanels.remove(task);
//        activeScanPanel.dispose();
//        this.remove(activeScanPanel);
        this.revalidate();
        this.repaint();
    }

    @Override
    public void onTaskException(Task task, Throwable throwable) {

    }
}
