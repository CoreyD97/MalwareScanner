package com.coreyd97.antivirus.client.engine;

import com.coreyd97.antivirus.common.engine.ClientScannerEngine;
import com.coreyd97.antivirus.common.report.ScanReport;
import com.coreyd97.antivirus.common.taskscheduler.FileTask;
import com.coreyd97.antivirus.common.utils.Utils;

import java.io.File;
import java.io.IOException;
import java.security.MessageDigest;
import java.security.NoSuchAlgorithmException;
import java.util.HashMap;

public class HashScannerEngine extends ClientScannerEngine {
    public static final String engineName = "Hash Scanner";
    private Utils.HashType hashType;

    public HashScannerEngine(Utils.HashType hashType) {
        super(engineName);
        this.hashType = hashType;
    }

    @Override
    public FileTask generateScanTask(File[] files) {
        return new HashScanTask("Hash Scan", files, new ScanReport(this));
    }

    private class HashScanTask extends FileTask {

        HashScanTask(String name, File[] files, ScanReport scanReport) {
            super(name, files, scanReport);
        }

        @Override
        protected void processFile(File file) {
            HashMap<String, String> features = new HashMap<>();
            features.put("HashType", hashType.toString());
            try {
                features.put(hashType.toString(), Utils.fileChecksum(MessageDigest.getInstance(hashType.toString()), file));
            } catch (NoSuchAlgorithmException | IOException e) {}

            ((ScanReport) report).addFile(file, features);
        }
    }

}
