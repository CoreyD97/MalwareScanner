package com.coreyd97.antivirus.server.taskscheduler;

import com.coreyd97.antivirus.common.network.ServerConnectionHandler;
import com.coreyd97.antivirus.common.taskscheduler.NetworkTask;
import org.apache.commons.codec.DecoderException;

import java.io.IOException;
import java.net.Inet4Address;
import java.net.UnknownHostException;
import java.security.GeneralSecurityException;
import java.util.ArrayList;

public class GetBannedClients extends NetworkTask<ArrayList<Inet4Address>> {



    public GetBannedClients(ServerConnectionHandler networkController) {
        super("Get Banned Clients", networkController);
    }

    @Override
    protected ArrayList<Inet4Address> interact() throws IOException, GeneralSecurityException, DecoderException {
        taskAddSteps(2);
        send("LISTBANS");
        taskProgress();
        ArrayList<Inet4Address> clients = new ArrayList<>();
        String response;
        while(!(response = readLine()).equals("END")){
            try {
                Inet4Address bannedClient = (Inet4Address) Inet4Address.getByName(response);
                clients.add(bannedClient);
            }catch (UnknownHostException ignored){}
        };
        taskProgress();
        return clients;
    }

    @Override
    protected ArrayList<Inet4Address> onFailure() {
        return null;
    }

    @Override
    public int getPriority() {
        return 100;
    }
}
