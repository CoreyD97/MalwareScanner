package com.coreyd97.antivirus.server.network;

import java.io.*;
import java.net.Socket;
import java.util.logging.Logger;

public class ClientConnection extends Thread {
    final ServerNetworkController serverNetworkController;
    final Socket socket;


    public ClientConnection(ServerNetworkController serverNetworkController, Socket clientSocket){
        this.serverNetworkController = serverNetworkController;
        this.socket = clientSocket;
    }

    @Override
    public void run() {
        BufferedReader bufferedReader;
        PrintWriter outputStream;

        try{
            bufferedReader = new BufferedReader(new InputStreamReader(socket.getInputStream()));
            outputStream = new PrintWriter(socket.getOutputStream(), true);
        } catch (IOException e) {
            for (NetworkListener networkListener : serverNetworkController.getListeners()) {
                networkListener.onNetworkError((ClientNetworkException) e);
            }
            return;
        }

        String line;
        while(true){
            try{
                line = bufferedReader.readLine();
                Logger.getLogger("NETWORK").info("Received: " + line);
                if(line.equals("Identify")){
                    outputStream.println("CerberusAVServer");
                    this.socket.close();
                    return;
                }else{
                    //TODO parse client messages
                }
            } catch (IOException e) {
                e.printStackTrace();
            }
        }
    }





    public static class ClientNetworkException extends IOException{}
}