package com.coreyd97.antivirus.server.network;

import com.coreyd97.antivirus.common.engine.CryptoManager;
import com.coreyd97.antivirus.common.network.ClientConnection;
import com.coreyd97.antivirus.common.network.ServerThread;
import com.coreyd97.antivirus.server.AntiVirusServer;
import com.coreyd97.antivirus.server.clients.ClientManager;
import com.coreyd97.antivirus.server.engine.AnalysisManager;

import java.io.IOException;
import java.net.Inet4Address;
import java.net.Socket;

public class AVClientHandler extends ServerThread {

    private final AnalysisManager analysisManager;
    private final ClientManager clientManager;

    public AVClientHandler(AnalysisManager analysisManager, ClientManager clientManager,
                           CryptoManager cryptoManager, short port) throws IOException {
        this(analysisManager, clientManager, cryptoManager, (Inet4Address) Inet4Address.getByName("0.0.0.0"), port);
    }

    public AVClientHandler(AnalysisManager analysisManager, ClientManager clientManager,
                           CryptoManager cryptoManager, Inet4Address listenAddress, short port) throws IOException {
        super(cryptoManager, listenAddress, port);
        this.clientManager = clientManager;
        this.analysisManager = analysisManager;
    }

    @Override
    public ClientConnection buildClient(Socket clientSocket) throws IOException {
        return new AVClientConnection(this, clientSocket);
    }

    public AnalysisManager getAnalysisManager() {
        return analysisManager;
    }

    public ClientManager getClientManager() {
        return clientManager;
    }
}
